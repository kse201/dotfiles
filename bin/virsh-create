#!/bin/sh

DISC_DIR=/var/lib/libvirt/images
IMG_DIR=/var/lib/libvirt/images

while getopts "d:i:n:" OPT
do
    case $OPT in
        d)
        DOMAIN_NAME=$OPTARG
        ;;
        i)
        ISO=$OPTARG
        ;;
        n)
        NETWORK=$OPTARG
        ;;
    esac
done

if [ $ISO == "" ] ;  then
    exit 1
fi
# redirect
DOMAIN_NAME=${DOMAIN_NAME:-`whoami`-`date +"%F-%s"`}
ISO=${DISC_DIR}/${ISO}

# network interface name 
NETWORK=${NETWORK:-default}

# create disk image file
IMG=${IMG_DIR}/${DOMAIN_NAME}.img
qemu-img create -f qcow2 ${IMG} 10G

# exec install 
virt-install \
    --connect qemu:///system \
    --disk=${IMG},format=qcow2 \
    --hvm \
    --keymap ja \
    --location ${ISO} \
    --name ${DOMAIN_NAME} \
    --network network=${NETWORK} \
    --nographics \
    --os-type=Linux \
    --os-variant=virtio26 \
    --ram=1024 \
    --extra-args='console=tty0 console=ttyS0,115200n8' \
